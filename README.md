# EchoValley
TODO 适配
https://github.com/CymChad/BaseRecyclerViewAdapterHelper
https://github.com/scwang90/SmartRefreshLayout

手撕，从刷新控件的功能展开
刷新控件是移动开发中上层几乎必然接触到的控件之一，市面上的开源刷新控件数不胜数，功能日益强大（为了满足产品不断增长的设计需求，哦不，是为了给用户更好的交互体验）。
本套框架的目的，当然不是去讲述怎样去做好一个功能完善的刷新控件，大家直接学习各位大神的源码即可，没必要班门弄斧了。
So，这篇框架的目的究竟是什么，要解决哪些痛点呢？
让我们想想刷新控件使用的场景是什么？
一个最常见的场景：分页加载（下拉刷新，上拉加载更多）
那么我们就来分析一下在这一场景下，我们都有哪些常规操作及可能的结果
1、下拉刷新，从数据源获取数据，填充。可能的结果
   2.1 没有数据，显示空白页
   2.2 比设定每页数量少，没有更多
   2.3 发生错误，显示错误页
   2.4 正常加载第一页
2、上拉加载更多，从数据源获取数据，填充。可能的结果
   2.1 比设定每页数量少，没有更多
   2.2 发生错误，显示错误页
   2.3 正常加载当前页

你至少
1、必须手动维护页数，对所有上述操作的的结果进行响应，特别需要小心的，对于发生错误的场景
2、必须手动维护空白页，错误页，列表视图的显示或者隐藏

这些工作有什么技术含量吗？没有。
那么每次遇到这样刷新需求，都要去重复完成这样的工作，对自己有实质上的提高吗？没有。
那么有人想要做出些改变吗？没有。
因为这些都是一线开发人员每天需要面对的，又没有什么难度，改变往往吃力不讨好，有动力吗？没有。

But，这不是笔者的风格。
本套框架的目前就是要消灭这种重复工作，当然不仅仅是分页加载的这一场景。
肯定有人会提出来，市面上的刷新控件这么多，怎么可能一套代码实现？
不好意思，这不是笔者的风格。不要你觉得，我要我觉得。
肯定还是会有人提出来，上拉加载更多发生错误的时候，我不想显示错误页，而是在Footer上提示，这种个性化的需求千差万别，怎么可能覆盖到全部？
这个问题目前还真回答不了，请允许笔者先按照上面提到的这种最通用的场景讲下去。

好了，铺垫了那么多，终于可以切入正题了。
好了，肯定还是有人一脸问号，先让笔者讲完好吗？
请淡定地拿出瓜子和小板凳，开始了！

首先定义一个概念，IViewModule——专注于某个连贯的功能单元的一组View。
那么对于专注于刷新控件展开的连贯的功能单元的一组View，可以定义为IRefreshViewModule。
根据这组View应该实现的最基础的方法，可以给出这样的定义：
public interface IRefreshViewModule extends IResponseHandler, IViewModule {
    void onEmpty();

    void onNonEmpty();

    int getPullAction();
}
其中
public interface IResponseHandler {
    void onCancel();

    void onError(Throwable throwable);
}
顾名思义，不需要额外解释。

既然是一组View，让我们来分析一下这组View应该有哪些成员
1、刷新控件，支持上拉下拉动作的容器
2、列表控件，用来填充数据，常见就是RecyclerView和ListView，但在这一场景下我们更关心它们的adapter
3、空白页（可选）
4、错误页（可选）

上面的四个成员中，空白页和错误页没有什么疑问（对于ListView和BRVAH，把空白页作为自身的成员变量，个人表示不太认同，显得不太纯粹，由于完全可以不依赖，所以应该没有影响）
问题在于
1、刷新控件，可以选择的相当的多，当然还可以自定义。
2、adapter，几乎每个项目都会在官方版本的基础上做自己的封装。
可能的组合是海量，怎么办？

噔噔噔噔
让我们祭出伟大的桥接模式（Bridge Pattern）
先复习一下它的定义：将抽象部分与它的实现部分分离，使它们可以独立地变化。
上结构图（来源于网络，大话设计模式，设计模式：可复用面向对象软件的基础）

落实到我们具体的场景

